<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Carlos Buenosvinos  | Saved 500 Kbytes of autoload classmap with autoload-dev at @AtrapaloEng</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.58.3" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    
    
    <meta property="og:title" content="Saved 500 Kbytes of autoload classmap with autoload-dev at @AtrapaloEng" />
<meta property="og:description" content="This week, at Atrápalo, we have reviewed our autoloading Composer configuration to use PSR-4 and split production classmap from development classmap to save some space in our Opcache. The result, 500 Kbytes less. Let&#8217;s see some details." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://carlosbuenosvinos.github.io/saved-500-kbytes-of-autoload-classmap-with-autoload-dev-at-atrapaloeng/" />
<meta property="article:published_time" content="2016-04-14T07:30:15+00:00" />
<meta property="article:modified_time" content="2016-04-14T07:30:15+00:00" />
<meta itemprop="name" content="Saved 500 Kbytes of autoload classmap with autoload-dev at @AtrapaloEng">
<meta itemprop="description" content="This week, at Atrápalo, we have reviewed our autoloading Composer configuration to use PSR-4 and split production classmap from development classmap to save some space in our Opcache. The result, 500 Kbytes less. Let&#8217;s see some details.">


<meta itemprop="datePublished" content="2016-04-14T07:30:15&#43;00:00" />
<meta itemprop="dateModified" content="2016-04-14T07:30:15&#43;00:00" />
<meta itemprop="wordCount" content="464">



<meta itemprop="keywords" content="autoload,composer,performance,php," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Saved 500 Kbytes of autoload classmap with autoload-dev at @AtrapaloEng"/>
<meta name="twitter:description" content="This week, at Atrápalo, we have reviewed our autoloading Composer configuration to use PSR-4 and split production classmap from development classmap to save some space in our Opcache. The result, 500 Kbytes less. Let&#8217;s see some details."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('https://carlosbuenosvinos.github.io/posts/images/2016/04/logo-composer-transparent.png');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://carlosbuenosvinos.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      Carlos Buenosvinos
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Saved 500 Kbytes of autoload classmap with autoload-dev at @AtrapaloEng</h1>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Saved 500 Kbytes of autoload classmap with autoload-dev at @AtrapaloEng</h1>
      
      <p class="tracked">
         By <strong>Carlos Buenosvinos</strong>
      </p>
      
      
      <time class="f6 mv4 dib tracked" datetime="2016-04-14T07:30:15Z">April 14, 2016</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>This week, at Atrápalo, we have reviewed our autoloading Composer configuration to use PSR-4 and split production classmap from development classmap to save some space in our Opcache. The result, 500 Kbytes less. Let&#8217;s see some details.</p>

<p>As you may know, when going to production, it&#8217;s a best practice to run &#8220;php composer.phar dump-autoload &#8211;optimize &#8211;no-dev&#8221; as one of your steps, or just &#8220;php composer.phar install [&#8230;] &#8211;optimize-autoloader &#8211;no-dev&#8221; when installing your dependencies.</p>

<p>With this command, Composer generates a PHP file with a big array where keys are the names of all classes in your project and the values are the path where they can be found. With this approach, autoloading a class is as easy as requiring the result of one access to a PHP array, fast.</p>

<pre class="brush: php; gutter: true">&lt;?php

// autoload_classmap.php @generated by Composer

$vendorDir = dirname(dirname(__FILE__));
$baseDir = dirname($vendorDir);

return array(
    //...
    &#039;Atrapalo\\Catalog\\Domain\\Accommodation\\Rate\\Price&#039; =&gt; $baseDir . &#039;/src/Atrapalo/Catalog/Domain/Accommodation/Rate/Price.php&#039;,
    &#039;Atrapalo\\Catalog\\Domain\\Accommodation\\Rate\\Rate&#039; =&gt; $baseDir . &#039;/src/Atrapalo/Catalog/Domain/Accommodation/Rate/Rate.php&#039;,
    &#039;Atrapalo\\Catalog\\Domain\\Accommodation\\Rate\\RateServices&#039; =&gt; $baseDir . &#039;/src/Atrapalo/Catalog/Domain/Accommodation/Rate/RateServices.php&#039;,
    //...
);</pre>

<p>Because the classmap file is a PHP file, it gets loaded into Opcache, fast again. But, if we take a closer look, there are some entries in this array related to your test classes that make the array bigger than needed for production. There are different options for removing those unnecessary entries:</p>

<ol>
<li><p><a href="https://getcomposer.org/doc/04-schema.md#exclude-files-from-classmaps" target="_blank">exclude-files-from-classmaps:</a> If you want to exclude some files or folders from the classmap you can use the &#8216;exclude-from-classmap&#8217; property. This might be useful to exclude test classes in your live environment, for example, as those will be skipped from the classmap even when building an optimized autoloader.The classmap generator will ignore all files in the paths configured here. The paths are absolute from the package root directory (i.e. composer.json location), and support <code>*</code> to match anything but a slash, and <code>**</code> to match anything. <code>**</code> is implicitly added to the end of the paths.Example: <pre class="brush: javascript; gutter: true">{
&ldquo;autoload&rdquo;: {
    &ldquo;exclude-from-classmap&rdquo;: [&ldquo;/Tests/&rdquo;, &ldquo;/test/&rdquo;, &ldquo;/tests/&rdquo;]
}
}</pre></p></li>

<li><p><a href="https://getcomposer.org/doc/04-schema.md#autoload-dev" target="_blank">autoload-dev</a>: This section allows to define autoload rules for development purposes.Classes needed to run the test suite should not be included in the main autoload rules to avoid polluting the autoloader in production and when other people use your package as a dependency.Therefore, it is a good idea to rely on a dedicated path for your unit tests and to add it within the autoload-dev section.Example: <pre class="brush: javascript; gutter: true">{
&ldquo;autoload&rdquo;: {
    &ldquo;psr-4&rdquo;: { &ldquo;MyLibrary\&ldquo;: &ldquo;src/&rdquo; }
},
&ldquo;autoload-dev&rdquo;: {
    &ldquo;psr-4&rdquo;: { &ldquo;MyLibrary\Tests\&ldquo;: &ldquo;tests/&rdquo; }
}
}</pre></p></li>
</ol>

<p>With all these considerations, we have grouped all our test classes into a /tests folder, we have added PSR-4 splitting dev and no-dev.</p>

<pre class="brush: bash; gutter: true"># ls -lah vendor/composer/autoload_classmap.php
-rw-r--r-- 1 wwwagent wwwagent 4,8M abr 11 11:01 vendor/composer/autoload_classmap.php
</pre>

<pre class="brush: bash; gutter: true"># ls -lah vendor/composer/autoload_classmap.php
-rw-r--r-- 1 wwwagent wwwagent 4,3M abr 12 16:46 vendor/composer/autoload_classmap.php
</pre>

<p>The result is 500Kb less. For more information, take a look to <a href="http://es.slideshare.net/javier.eguiluz/new-symfony-tips-tricks-symfonycon-paris-2015" target="_blank"><a href="http://es.slideshare.net/javier.eguiluz/new-symfony-tips-tricks-symfonycon-paris-2015">http://es.slideshare.net/javier.eguiluz/new-symfony-tips-tricks-symfonycon-paris-2015</a></a> by Javier Eguiluz.</p><ul class="pa0">
  
   <li class="list">
     <a href="/tags/autoload" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">autoload</a>
   </li>
  
   <li class="list">
     <a href="/tags/composer" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">composer</a>
   </li>
  
   <li class="list">
     <a href="/tags/performance" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">performance</a>
   </li>
  
   <li class="list">
     <a href="/tags/php" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">php</a>
   </li>
  
</ul>
<div class="mt6">
      
      
      </div>
    </section>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/first-tests-with-php7-in-production-at-atrapaloeng/">First tests with #PHP7 in production at @AtrapaloEng</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/rendimiento-con-domain-events-proyecciones-y-principios-de-cqrs/">Rendimiento con Domain Events, Proyecciones y principios de CQRS</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/guia-para-el-desarrollo-profesional-php-edicion-2014/">Guía para el Desarrollo Profesional PHP (edición 2014)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/legacy-code-and-teams-series-composer/">Legacy Code and Teams Series: Composer</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/ipackagist-the-packagist-client-for-iphone/">iPackagist, the Packagist Client for iPhone</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/working-at-the-same-time-in-a-project-and-its-dependencies-composer-and-path-type-repository/">Working at the same time in a project and its dependencies: Composer and path type repository</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/restgames-more-than-katas/">RESTGames – More than katas</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/setup-your-macos-development-team-with-ansible/">Setup your MacOS (or other OS) development team with Ansible</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/consulta-sobre-ddd-1-entidades-identidad-uuid/">Consulta sobre DDD #1: Pregunta sobre las entidades en DDD (Identidad y UUID)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/dot-puzzles-for-smart-masses/">Dot: Puzzles for smart masses</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/migrating-progressively-to-symfony-without-pain-with-stackphp/">Migrating progressively to Symfony without pain with StackPHP</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/migrating-progressively-to-symfony-without-pain/">Migrating progressively to Symfony without pain</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/atrapalo-tech-2014-figures/">Atrápalo Tech 2014 figures</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/subscribe-yourself-to-php-internals/">Subscribe yourself to PHP internals</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/domain-driven-design-code-structure-and-application-services-webcast-at-atrapaloeng-spanish/">Domain-Driven Design: Code Structure and Application Services Webcast at @AtrapaloEng (Spanish)</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://carlosbuenosvinos.github.io/" >
    &copy; 2019 Carlos Buenosvinos
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
