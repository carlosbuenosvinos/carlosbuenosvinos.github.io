<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Carlos Buenosvinos  | Remove non used PHP files in your project</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.58.3" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    
    
    <meta property="og:title" content="Remove non used PHP files in your project" />
<meta property="og:description" content="When a project gets bigger, specially when using a framework, it&#8217;s mandatory to have some processes that help you in removing code that is not used anymore such as models, classes, template files, etc.

That is not an easy task, however the benefits or removing non used coded are tons (code coverage, development speed, bugs, etc.). But what&#8217;s the best approach to detect that a template file is not used anymore in your PHP project?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://carlosbuenosvinos.github.io/remove-non-used-php-files-in-your-project/" />
<meta property="article:published_time" content="2013-09-26T07:40:56+00:00" />
<meta property="article:modified_time" content="2013-09-26T07:40:56+00:00" />
<meta itemprop="name" content="Remove non used PHP files in your project">
<meta itemprop="description" content="When a project gets bigger, specially when using a framework, it&#8217;s mandatory to have some processes that help you in removing code that is not used anymore such as models, classes, template files, etc.

That is not an easy task, however the benefits or removing non used coded are tons (code coverage, development speed, bugs, etc.). But what&#8217;s the best approach to detect that a template file is not used anymore in your PHP project?">


<meta itemprop="datePublished" content="2013-09-26T07:40:56&#43;00:00" />
<meta itemprop="dateModified" content="2013-09-26T07:40:56&#43;00:00" />
<meta itemprop="wordCount" content="423">



<meta itemprop="keywords" content="clean code,opcache,symfony,zend," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Remove non used PHP files in your project"/>
<meta name="twitter:description" content="When a project gets bigger, specially when using a framework, it&#8217;s mandatory to have some processes that help you in removing code that is not used anymore such as models, classes, template files, etc.

That is not an easy task, however the benefits or removing non used coded are tons (code coverage, development speed, bugs, etc.). But what&#8217;s the best approach to detect that a template file is not used anymore in your PHP project?"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://carlosbuenosvinos.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      Carlos Buenosvinos
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Remove non used PHP files in your project</h1>
      
      <p class="tracked">
         By <strong>Carlos Buenosvinos</strong>
      </p>
      
      
      <time class="f6 mv4 dib tracked" datetime="2013-09-26T07:40:56Z">September 26, 2013</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>When a project gets bigger, specially when using a framework, it&#8217;s mandatory to have some processes that help you in removing code that is not used anymore such as models, classes, template files, etc.</p>

<p>That is not an easy task, however the benefits or removing non used coded are tons (code coverage, development speed, bugs, etc.). But what&#8217;s the best approach to detect that a template file is not used anymore in your PHP project?</p>

<p>We discuss about that at <a href="http://www.emagister.com" target="_blank">Emagister</a> with <a href="http://twitter.com/eberhm" target="_blank">Eber Herrera</a> and we get to two different approaches that might help you.</p>

<h2 id="code-analysis-approach"><strong>Code analysis approach</strong></h2>

<p>For each type of object you want to remove, you can create a command to do it. However, the main algorithm is:</p>

<ol>
<li>Get a list of items to check (list of models, view helpers, etc.): <a href="http://symfony.com/doc/current/components/finder.html" target="_blank">Symfony Finder Component</a> can help you</li>
<li>Iterate on your code and grep it or parse it: <a href="https://github.com/nikic/PHP-Parser" target="_blank">PHP Parser</a> can do the job</li>
<li>Report the object that is candidate to be removed</li>
<li>Manual review, remove and feel like a star!</li>
</ol>

<p>It&#8217;s possible that every type of object needs a different strategy. However, this process can be applied in most cases. For example, ViewHelpers in Zend Framework that are not called, TPLs that are not included, etc.</p>

<p>What&#8217;s the problem? Some objects usage depends on an application request so you should check your access logs. But there&#8217;s another approach.</p>

<h2 id="opcode-cached-files-approach"><strong>Opcode cached files approach</strong></h2>

<p>And there&#8217;s the tricky one! If you have played a bit with opcache (if not you should because it&#8217;s faster than APC), you will see that is easy to get a list of all the files cache by the opcache.</p>

<p>At Emagister, we have developed a command, that connects to our opcache, gets the cached files, stores that info in a redis and the computes the difference with the files in our project. We run this process frequently.</p>

<p>Benefits are that it does not affect the performance, it&#8217;s base on real usage of your site (so let the command work and check from time to time the differences) and it affects any object because it checks the file usage, not the objects contained in it, so no parsing needed.</p>

<pre class="brush: php; gutter: true">$status = opcache_get_status();
foreach($status[&#039;scripts&#039;] as $key=&gt;$data) {
    $dirs[dirname($key)][basename($key)]=$data;
}

asort($dirs);

foreach($dirs as $dir =&gt; $files) {
    foreach ($files as $file =&gt; $data) {
        // $data["hits"] holds hits for the script
        // $file has the filename
        // $dir has the path
    }
}</pre>

<p>And remember children! Keep your clean code. You will be a happier developer and you&#8217;ll make others happier.</p><ul class="pa0">
  
   <li class="list">
     <a href="/tags/clean-code" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">clean code</a>
   </li>
  
   <li class="list">
     <a href="/tags/opcache" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">opcache</a>
   </li>
  
   <li class="list">
     <a href="/tags/symfony" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">symfony</a>
   </li>
  
   <li class="list">
     <a href="/tags/zend" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">zend</a>
   </li>
  
</ul>
<div class="mt6">
      
      
      </div>
    </section>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/robert-c-martin-clean-code-collection-review-part-ii/">Robert C. Martin Clean Code Collection Review (Part II)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/zend-certification-more-than-20000-views/">Zend PHP 5.3 Demo Certification Test: More than 20.000 views!</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://carlosbuenosvinos.github.io/" >
    &copy; 2019 Carlos Buenosvinos
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
